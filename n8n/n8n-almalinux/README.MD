### **Guide: Automated n8n Installation on AlmaLinux**

This script provides a comprehensive, automated solution for installing n8n on a server running AlmaLinux 8+ (or a similar RHEL-based distribution). It handles the entire process, including installing dependencies, setting up Docker with PostgreSQL, configuring an Nginx reverse proxy, and securing the site with a free Let's Encrypt SSL certificate.

### **Key Features**

- **Targeted for AlmaLinux**: Uses the `dnf` package manager and installs necessary repositories like EPEL.
- **DNS Validation**: Before starting, it automatically verifies that your domain correctly points to the server's IP address.
- **SELinux Aware**: The script detects if SELinux is enabled and applies the necessary policy to allow Nginx to make network connections, preventing common "502 Bad Gateway" errors.
- **Full Cleanup**: Can detect and completely remove any previous n8n installations to ensure a clean slate.
- **Automated Nginx & SSL**: Automatically creates the Nginx reverse proxy configuration and uses `certbot` to install and auto-renew a Let's Encrypt SSL certificate.
- **Dual Setup Modes**:
  - **Manual Mode**: Allows you to input all your custom credentials.
  - **Automatic Mode**: Generates all necessary credentials for you for a fast and easy setup.
- **Post-Install Health Check**: Verifies that the n8n container is running and successfully connected to the database after installation.

### **Prerequisites**

- A server running **AlmaLinux 8+** or a similar RHEL-based OS (like Rocky Linux or CentOS).
- `sudo` or `root` access.
- A **domain name** (e.g., `n8n.your-domain.com`) with its DNS 'A' record already pointed to your server's public IP address.

---

### **How to Use**

#### **Step 1: Download the Script**

Connect to your server via SSH and download the script using `wget`.

```bash
wget https://raw.githubusercontent.com/trangc0der/trangc0der-tools/main/n8n/n8n-almalinux/n8n-almalinux.sh
```

#### **Step 2: Make the Script Executable**

Grant execute permissions to the downloaded file.

```bash
chmod +x n8n-almalinux.sh
```

#### **Step 3: Run the Script**

Execute the script with `sudo` to begin the installation.

```bash
sudo ./n8n-almalinux.sh
```

#### **Step 4: Follow the On-Screen Prompts**

The script is interactive and will guide you through the setup:

1.  **Previous Installation Check**: If an existing n8n setup is found, the script will ask if you want to perform a full cleanup before proceeding.
2.  **Domain Name**: Enter your domain name when prompted. The script will then perform a DNS check to validate it. If the check fails, you can choose to re-check, ignore the warning, or cancel the installation.
3.  **Installation Mode**: Choose between two modes:
    - **Manual Mode (1)**: You will be prompted to enter an email for SSL registration, a username/password for n8n, and credentials for the PostgreSQL database.
    - **Automatic Mode (2)**: The script will automatically generate all credentials based on your domain and server IP. It will display the generated information for you to save.

The script will then handle the entire installation process automatically.

### **Post-Installation**

After the script completes, it will display a summary of your configuration details and credentials.

- **Access Your n8n Instance**: You can now access your n8n instance by navigating to your domain in a web browser: `https://your-domain.com`
- **Log In**: Use the n8n username and password that were either provided by you (Manual Mode) or generated by the script (Automatic Mode).

### **Managing Your n8n Instance**

- **Configuration Directory**: All n8n and PostgreSQL data and configuration files are located in the `~/n8n_data` directory.
- **View n8n Logs**:
  ```bash
  docker logs n8n
  ```
- **Restart n8n**:
  ```bash
  docker restart n8n
  ```
- **Stop/Start n8n**:
  ```bash
  docker stop n8n
  docker start n8n
  ```
- **Troubleshooting**:
  - For database connection issues, try restarting both services: `docker restart postgres n8n`
  - If you encounter a **502 Bad Gateway** error, it may be related to SELinux. You can try running: `sudo setsebool -P httpd_can_network_connect 1` and then restart Nginx.
